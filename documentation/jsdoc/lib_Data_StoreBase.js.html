

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: lib/Data/StoreBase.js | Companion</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 147px; height: 24px">
        
            <a href="https://bitfocus.io" rel="noopener noreferrer" target="_blank">
                <img src="https://bitfocus.io/images/topbar-logowhite.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Companion</a></h1>
        
            <span class="version">v2.3.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="BankActionController.html">BankActionController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankActionController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankActionController.html#actions">actions</a></li><li><a href="BankActionController.html#actionsRunning">actionsRunning</a></li><li><a href="BankActionController.html#bankStatus">bankStatus</a></li><li><a href="BankActionController.html#debug">debug</a></li><li><a href="BankActionController.html#definitions">definitions</a></li><li><a href="BankActionController.html#logSource">logSource</a></li><li><a href="BankActionController.html#.PageStyles">PageStyles</a></li><li><a href="BankActionController.html#registry">registry</a></li><li><a href="BankActionController.html#releaseActions">releaseActions</a></li><li><a href="BankActionController.html#skipNext">skipNext</a></li><li><a href="BankActionController.html#skipUp">skipUp</a></li><li><a href="BankActionController.html#system">system</a></li><li><a href="BankActionController.html#timersRunning">timersRunning</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankActionController.html#bank">bank</a></li><li><a href="BankActionController.html#db">db</a></li><li><a href="BankActionController.html#deviceController">deviceController</a></li><li><a href="BankActionController.html#graphics">graphics</a></li><li><a href="BankActionController.html#instance">instance</a></li><li><a href="BankActionController.html#io">io</a></li><li><a href="BankActionController.html#log">log</a></li><li><a href="BankActionController.html#page">page</a></li><li><a href="BankActionController.html#schedule">schedule</a></li><li><a href="BankActionController.html#services">services</a></li><li><a href="BankActionController.html#userconfig">userconfig</a></li></ul></div></li><li><a href="BankActionDefinition.html">BankActionDefinition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankActionDefinition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankActionDefinition.html#label">label</a></li><li><a href="BankActionDefinition.html#options">options</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankActionDefinition.html#callback">callback</a></li><li><a href="BankActionDefinition.html#subscribe">subscribe</a></li><li><a href="BankActionDefinition.html#unsubscribe">unsubscribe</a></li></ul></div></li><li><a href="BankActionItems.html">BankActionItems</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankActionItems_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankActionItems.html#controller">controller</a></li><li><a href="BankActionItems.html#dbKey">dbKey</a></li><li><a href="BankActionItems.html#debug">debug</a></li><li><a href="BankActionItems.html#definitions">definitions</a></li><li><a href="BankActionItems.html#items">items</a></li><li><a href="BankActionItems.html#logSource">logSource</a></li><li><a href="BankActionItems.html#registry">registry</a></li><li><a href="BankActionItems.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankActionItems.html#addItem">addItem</a></li><li><a href="BankActionItems.html#addItemByClient">addItemByClient</a></li><li><a href="BankActionItems.html#bank">bank</a></li><li><a href="BankActionItems.html#checkBankExists">checkBankExists</a></li><li><a href="BankActionItems.html#checkBankStatus">checkBankStatus</a></li><li><a href="BankActionItems.html#checkInstanceStatus">checkInstanceStatus</a></li><li><a href="BankActionItems.html#checkStatus">checkStatus</a></li><li><a href="BankActionItems.html#cleanupItems">cleanupItems</a></li><li><a href="BankActionItems.html#db">db</a></li><li><a href="BankActionItems.html#deleteInstance">deleteInstance</a></li><li><a href="BankActionItems.html#deleteItem">deleteItem</a></li><li><a href="BankActionItems.html#deleteItemByClient">deleteItemByClient</a></li><li><a href="BankActionItems.html#deviceController">deviceController</a></li><li><a href="BankActionItems.html#getAll">getAll</a></li><li><a href="BankActionItems.html#getBank">getBank</a></li><li><a href="BankActionItems.html#getBankByClient">getBankByClient</a></li><li><a href="BankActionItems.html#getInstanceItems">getInstanceItems</a></li><li><a href="BankActionItems.html#getPage">getPage</a></li><li><a href="BankActionItems.html#graphics">graphics</a></li><li><a href="BankActionItems.html#importBank">importBank</a></li><li><a href="BankActionItems.html#instance">instance</a></li><li><a href="BankActionItems.html#io">io</a></li><li><a href="BankActionItems.html#log">log</a></li><li><a href="BankActionItems.html#page">page</a></li><li><a href="BankActionItems.html#resetBank">resetBank</a></li><li><a href="BankActionItems.html#save">save</a></li><li><a href="BankActionItems.html#schedule">schedule</a></li><li><a href="BankActionItems.html#services">services</a></li><li><a href="BankActionItems.html#setDefinitions">setDefinitions</a></li><li><a href="BankActionItems.html#subscribe">subscribe</a></li><li><a href="BankActionItems.html#subscribeBank">subscribeBank</a></li><li><a href="BankActionItems.html#unsubscribe">unsubscribe</a></li><li><a href="BankActionItems.html#unsubscribeBank">unsubscribeBank</a></li><li><a href="BankActionItems.html#updateItemDelay">updateItemDelay</a></li><li><a href="BankActionItems.html#updateItemOption">updateItemOption</a></li><li><a href="BankActionItems.html#updateItemOrder">updateItemOrder</a></li><li><a href="BankActionItems.html#userconfig">userconfig</a></li></ul></div></li><li><a href="BankFeedbackController.html">BankFeedbackController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankFeedbackController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankFeedbackController.html#debug">debug</a></li><li><a href="BankFeedbackController.html#logSource">logSource</a></li><li><a href="BankFeedbackController.html#registry">registry</a></li><li><a href="BankFeedbackController.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankFeedbackController.html#bank">bank</a></li><li><a href="BankFeedbackController.html#db">db</a></li><li><a href="BankFeedbackController.html#deviceController">deviceController</a></li><li><a href="BankFeedbackController.html#graphics">graphics</a></li><li><a href="BankFeedbackController.html#instance">instance</a></li><li><a href="BankFeedbackController.html#io">io</a></li><li><a href="BankFeedbackController.html#log">log</a></li><li><a href="BankFeedbackController.html#page">page</a></li><li><a href="BankFeedbackController.html#schedule">schedule</a></li><li><a href="BankFeedbackController.html#services">services</a></li><li><a href="BankFeedbackController.html#userconfig">userconfig</a></li></ul></div></li><li><a href="BankFeedbackDefinition.html">BankFeedbackDefinition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankFeedbackDefinition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankFeedbackDefinition.html#description">description</a></li><li><a href="BankFeedbackDefinition.html#label">label</a></li><li><a href="BankFeedbackDefinition.html#options">options</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankFeedbackDefinition.html#callback">callback</a></li><li><a href="BankFeedbackDefinition.html#subscribe">subscribe</a></li><li><a href="BankFeedbackDefinition.html#unsubscribe">unsubscribe</a></li></ul></div></li><li><a href="BankFeedbackItems.html">BankFeedbackItems</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankFeedbackItems_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankFeedbackItems.html#controller">controller</a></li><li><a href="BankFeedbackItems.html#dbKey">dbKey</a></li><li><a href="BankFeedbackItems.html#debug">debug</a></li><li><a href="BankFeedbackItems.html#definitions">definitions</a></li><li><a href="BankFeedbackItems.html#items">items</a></li><li><a href="BankFeedbackItems.html#logSource">logSource</a></li><li><a href="BankFeedbackItems.html#registry">registry</a></li><li><a href="BankFeedbackItems.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankFeedbackItems.html#addItem">addItem</a></li><li><a href="BankFeedbackItems.html#addItemByClient">addItemByClient</a></li><li><a href="BankFeedbackItems.html#bank">bank</a></li><li><a href="BankFeedbackItems.html#checkBankExists">checkBankExists</a></li><li><a href="BankFeedbackItems.html#checkBankStatus">checkBankStatus</a></li><li><a href="BankFeedbackItems.html#checkInstanceStatus">checkInstanceStatus</a></li><li><a href="BankFeedbackItems.html#checkStatus">checkStatus</a></li><li><a href="BankFeedbackItems.html#cleanupItems">cleanupItems</a></li><li><a href="BankFeedbackItems.html#db">db</a></li><li><a href="BankFeedbackItems.html#deleteInstance">deleteInstance</a></li><li><a href="BankFeedbackItems.html#deleteItem">deleteItem</a></li><li><a href="BankFeedbackItems.html#deleteItemByClient">deleteItemByClient</a></li><li><a href="BankFeedbackItems.html#deviceController">deviceController</a></li><li><a href="BankFeedbackItems.html#getAll">getAll</a></li><li><a href="BankFeedbackItems.html#getBank">getBank</a></li><li><a href="BankFeedbackItems.html#getBankByClient">getBankByClient</a></li><li><a href="BankFeedbackItems.html#getBankStyles">getBankStyles</a></li><li><a href="BankFeedbackItems.html#getInstanceItems">getInstanceItems</a></li><li><a href="BankFeedbackItems.html#getPage">getPage</a></li><li><a href="BankFeedbackItems.html#getStyle">getStyle</a></li><li><a href="BankFeedbackItems.html#graphics">graphics</a></li><li><a href="BankFeedbackItems.html#importBank">importBank</a></li><li><a href="BankFeedbackItems.html#instance">instance</a></li><li><a href="BankFeedbackItems.html#io">io</a></li><li><a href="BankFeedbackItems.html#log">log</a></li><li><a href="BankFeedbackItems.html#page">page</a></li><li><a href="BankFeedbackItems.html#resetBank">resetBank</a></li><li><a href="BankFeedbackItems.html#save">save</a></li><li><a href="BankFeedbackItems.html#schedule">schedule</a></li><li><a href="BankFeedbackItems.html#services">services</a></li><li><a href="BankFeedbackItems.html#setDefinitions">setDefinitions</a></li><li><a href="BankFeedbackItems.html#setStyle">setStyle</a></li><li><a href="BankFeedbackItems.html#subscribe">subscribe</a></li><li><a href="BankFeedbackItems.html#subscribeBank">subscribeBank</a></li><li><a href="BankFeedbackItems.html#unsubscribe">unsubscribe</a></li><li><a href="BankFeedbackItems.html#unsubscribeBank">unsubscribeBank</a></li><li><a href="BankFeedbackItems.html#updateItemOption">updateItemOption</a></li><li><a href="BankFeedbackItems.html#updateItemOrder">updateItemOrder</a></li><li><a href="BankFeedbackItems.html#userconfig">userconfig</a></li></ul></div></li><li><a href="BankItemDefinition.html">BankItemDefinition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankItemDefinition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankItemDefinition.html#label">label</a></li><li><a href="BankItemDefinition.html#options">options</a></li></ul></div></li><li><a href="BankItemsBase.html">BankItemsBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankItemsBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankItemsBase.html#controller">controller</a></li><li><a href="BankItemsBase.html#dbKey">dbKey</a></li><li><a href="BankItemsBase.html#definitions">definitions</a></li><li><a href="BankItemsBase.html#items">items</a></li><li><a href="BankItemsBase.html#logSource">logSource</a></li><li><a href="BankItemsBase.html#registry">registry</a></li><li><a href="BankItemsBase.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankItemsBase.html#addItem">addItem</a></li><li><a href="BankItemsBase.html#addItemByClient">addItemByClient</a></li><li><a href="BankItemsBase.html#bank">bank</a></li><li><a href="BankItemsBase.html#checkBankExists">checkBankExists</a></li><li><a href="BankItemsBase.html#checkInstanceStatus">checkInstanceStatus</a></li><li><a href="BankItemsBase.html#checkStatus">checkStatus</a></li><li><a href="BankItemsBase.html#cleanupItems">cleanupItems</a></li><li><a href="BankItemsBase.html#db">db</a></li><li><a href="BankItemsBase.html#deleteInstance">deleteInstance</a></li><li><a href="BankItemsBase.html#deleteItem">deleteItem</a></li><li><a href="BankItemsBase.html#deleteItemByClient">deleteItemByClient</a></li><li><a href="BankItemsBase.html#deviceController">deviceController</a></li><li><a href="BankItemsBase.html#getAll">getAll</a></li><li><a href="BankItemsBase.html#getBank">getBank</a></li><li><a href="BankItemsBase.html#getBankByClient">getBankByClient</a></li><li><a href="BankItemsBase.html#getInstanceItems">getInstanceItems</a></li><li><a href="BankItemsBase.html#getPage">getPage</a></li><li><a href="BankItemsBase.html#graphics">graphics</a></li><li><a href="BankItemsBase.html#importBank">importBank</a></li><li><a href="BankItemsBase.html#instance">instance</a></li><li><a href="BankItemsBase.html#io">io</a></li><li><a href="BankItemsBase.html#log">log</a></li><li><a href="BankItemsBase.html#page">page</a></li><li><a href="BankItemsBase.html#resetBank">resetBank</a></li><li><a href="BankItemsBase.html#save">save</a></li><li><a href="BankItemsBase.html#schedule">schedule</a></li><li><a href="BankItemsBase.html#services">services</a></li><li><a href="BankItemsBase.html#setDefinitions">setDefinitions</a></li><li><a href="BankItemsBase.html#subscribe">subscribe</a></li><li><a href="BankItemsBase.html#subscribeBank">subscribeBank</a></li><li><a href="BankItemsBase.html#unsubscribe">unsubscribe</a></li><li><a href="BankItemsBase.html#unsubscribeBank">unsubscribeBank</a></li><li><a href="BankItemsBase.html#updateItemOption">updateItemOption</a></li><li><a href="BankItemsBase.html#updateItemOrder">updateItemOrder</a></li><li><a href="BankItemsBase.html#userconfig">userconfig</a></li></ul></div></li><li><a href="BankStyle.html">BankStyle</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankStyle_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankStyle.html#alignment">alignment</a></li><li><a href="BankStyle.html#base64">base64</a></li><li><a href="BankStyle.html#bgcolor">bgcolor</a></li><li><a href="BankStyle.html#color">color</a></li><li><a href="BankStyle.html#png64">png64</a></li><li><a href="BankStyle.html#pngalignment">pngalignment</a></li><li><a href="BankStyle.html#size">size</a></li><li><a href="BankStyle.html#text">text</a></li></ul></div></li><li><a href="Config.html">Config</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Config_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Config.html#debug">debug</a></li><li><a href="Config.html#.SaveInterval">SaveInterval</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Config.html#deleteKey">deleteKey</a></li><li><a href="Config.html#getAll">getAll</a></li><li><a href="Config.html#getCfgDir">getCfgDir</a></li><li><a href="Config.html#getKey">getKey</a></li><li><a href="Config.html#load">load</a></li><li><a href="Config.html#loadBackup">loadBackup</a></li><li><a href="Config.html#loadDefaults">loadDefaults</a></li><li><a href="Config.html#save">save</a></li><li><a href="Config.html#saveMain">saveMain</a></li><li><a href="Config.html#setDirty">setDirty</a></li><li><a href="Config.html#setKey">setKey</a></li><li><a href="Config.html#setKeys">setKeys</a></li><li><a href="Config.html#setSaveCycle">setSaveCycle</a></li></ul></div></li><li><a href="CoreBase.html">CoreBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CoreBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CoreBase.html#logSource">logSource</a></li><li><a href="CoreBase.html#registry">registry</a></li><li><a href="CoreBase.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CoreBase.html#bank">bank</a></li><li><a href="CoreBase.html#db">db</a></li><li><a href="CoreBase.html#deviceController">deviceController</a></li><li><a href="CoreBase.html#graphics">graphics</a></li><li><a href="CoreBase.html#instance">instance</a></li><li><a href="CoreBase.html#io">io</a></li><li><a href="CoreBase.html#log">log</a></li><li><a href="CoreBase.html#page">page</a></li><li><a href="CoreBase.html#schedule">schedule</a></li><li><a href="CoreBase.html#services">services</a></li><li><a href="CoreBase.html#userconfig">userconfig</a></li></ul></div></li><li><a href="Database.html">Database</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Database_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Database.html#debug">debug</a></li><li><a href="Database.html#registry">registry</a></li><li><a href="Database.html#.SaveInterval">SaveInterval</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Database.html#deleteKey">deleteKey</a></li><li><a href="Database.html#getAll">getAll</a></li><li><a href="Database.html#getCfgDir">getCfgDir</a></li><li><a href="Database.html#getKey">getKey</a></li><li><a href="Database.html#load">load</a></li><li><a href="Database.html#loadBackup">loadBackup</a></li><li><a href="Database.html#loadDefaults">loadDefaults</a></li><li><a href="Database.html#save">save</a></li><li><a href="Database.html#saveMain">saveMain</a></li><li><a href="Database.html#setDirty">setDirty</a></li><li><a href="Database.html#setKey">setKey</a></li><li><a href="Database.html#setKeys">setKeys</a></li><li><a href="Database.html#setSaveCycle">setSaveCycle</a></li></ul></div></li><li><a href="DataStoreBase.html">DataStoreBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DataStoreBase_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="DataStoreBase.html#deleteKey">deleteKey</a></li><li><a href="DataStoreBase.html#getAll">getAll</a></li><li><a href="DataStoreBase.html#getCfgDir">getCfgDir</a></li><li><a href="DataStoreBase.html#getKey">getKey</a></li><li><a href="DataStoreBase.html#load">load</a></li><li><a href="DataStoreBase.html#loadBackup">loadBackup</a></li><li><a href="DataStoreBase.html#loadDefaults">loadDefaults</a></li><li><a href="DataStoreBase.html#save">save</a></li><li><a href="DataStoreBase.html#saveMain">saveMain</a></li><li><a href="DataStoreBase.html#setDirty">setDirty</a></li><li><a href="DataStoreBase.html#setKey">setKey</a></li><li><a href="DataStoreBase.html#setKeys">setKeys</a></li><li><a href="DataStoreBase.html#setSaveCycle">setSaveCycle</a></li></ul></div></li><li><a href="InterfaceClient.html">InterfaceClient</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="InterfaceClient_sub"><div class="member-type">Events</div><ul class="inner"><li><a href="InterfaceClient.html#~event:get_userconfig_all">get_userconfig_all</a></li><li><a href="InterfaceClient.html#~event:set_userconfig_key">set_userconfig_key</a></li><li><a href="InterfaceClient.html#~event:set_userconfig_key:result">set_userconfig_key:result</a></li></ul></div></li><li><a href="Registry.html">Registry</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Registry_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Registry.html#debug">debug</a></li><li><a href="Registry.html#.FileVersion">FileVersion</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Registry.html#getAppRoot">getAppRoot</a></li><li><a href="Registry.html#getCfgDir">getCfgDir</a></li><li><a href="Registry.html#getFileVersion">getFileVersion</a></li></ul></div></li><li><a href="ScheduleController.html">ScheduleController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ScheduleController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ScheduleController.html#debug">debug</a></li><li><a href="ScheduleController.html#logSource">logSource</a></li><li><a href="ScheduleController.html#registry">registry</a></li><li><a href="ScheduleController.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ScheduleController.html#action">action</a></li><li><a href="ScheduleController.html#bank">bank</a></li><li><a href="ScheduleController.html#cleanConfig">cleanConfig</a></li><li><a href="ScheduleController.html#db">db</a></li><li><a href="ScheduleController.html#deviceController">deviceController</a></li><li><a href="ScheduleController.html#eventLoadType">eventLoadType</a></li><li><a href="ScheduleController.html#eventWatch">eventWatch</a></li><li><a href="ScheduleController.html#findEventIndex">findEventIndex</a></li><li><a href="ScheduleController.html#getBankButton">getBankButton</a></li><li><a href="ScheduleController.html#getNextId">getNextId</a></li><li><a href="ScheduleController.html#getPlugin">getPlugin</a></li><li><a href="ScheduleController.html#getSchedule">getSchedule</a></li><li><a href="ScheduleController.html#graphics">graphics</a></li><li><a href="ScheduleController.html#initConfig">initConfig</a></li><li><a href="ScheduleController.html#instance">instance</a></li><li><a href="ScheduleController.html#io">io</a></li><li><a href="ScheduleController.html#loadPlugins">loadPlugins</a></li><li><a href="ScheduleController.html#log">log</a></li><li><a href="ScheduleController.html#page">page</a></li><li><a href="ScheduleController.html#saveSchedule">saveSchedule</a></li><li><a href="ScheduleController.html#saveToDb">saveToDb</a></li><li><a href="ScheduleController.html#schedule">schedule</a></li><li><a href="ScheduleController.html#sendPlugins">sendPlugins</a></li><li><a href="ScheduleController.html#services">services</a></li><li><a href="ScheduleController.html#startSchedule">startSchedule</a></li><li><a href="ScheduleController.html#updateSchedule">updateSchedule</a></li><li><a href="ScheduleController.html#userconfig">userconfig</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="ScheduleController.html#~getSchedule-callback">getSchedule-callback</a></li><li><a href="ScheduleController.html#~saveSchedule-callback">saveSchedule-callback</a></li><li><a href="ScheduleController.html#~sendPlugins-callback">sendPlugins-callback</a></li><li><a href="ScheduleController.html#~updateSchedule-callback">updateSchedule-callback</a></li></ul></div></li><li><a href="SchedulePluginBase.html">SchedulePluginBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SchedulePluginBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="SchedulePluginBase.html#multiple">multiple</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="SchedulePluginBase.html#add">add</a></li><li><a href="SchedulePluginBase.html#configDesc">configDesc</a></li><li><a href="SchedulePluginBase.html#frontEnd">frontEnd</a></li><li><a href="SchedulePluginBase.html#remove">remove</a></li><li><a href="SchedulePluginBase.html#setup">setup</a></li></ul></div></li><li><a href="ServiceBase.html">ServiceBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ServiceBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ServiceBase.html#logSource">logSource</a></li><li><a href="ServiceBase.html#registry">registry</a></li><li><a href="ServiceBase.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ServiceBase.html#bank">bank</a></li><li><a href="ServiceBase.html#db">db</a></li><li><a href="ServiceBase.html#deviceController">deviceController</a></li><li><a href="ServiceBase.html#disableModule">disableModule</a></li><li><a href="ServiceBase.html#enableModule">enableModule</a></li><li><a href="ServiceBase.html#graphics">graphics</a></li><li><a href="ServiceBase.html#handleSocketError">handleSocketError</a></li><li><a href="ServiceBase.html#init">init</a></li><li><a href="ServiceBase.html#instance">instance</a></li><li><a href="ServiceBase.html#io">io</a></li><li><a href="ServiceBase.html#log">log</a></li><li><a href="ServiceBase.html#page">page</a></li><li><a href="ServiceBase.html#schedule">schedule</a></li><li><a href="ServiceBase.html#services">services</a></li><li><a href="ServiceBase.html#setDefaults">setDefaults</a></li><li><a href="ServiceBase.html#updateUserconfig">updateUserconfig</a></li><li><a href="ServiceBase.html#userconfig">userconfig</a></li></ul></div></li><li><a href="System.html">System</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="System_sub"><div class="member-type">Events</div><ul class="inner"><li><a href="System.html#~event:config_get">config_get</a></li><li><a href="System.html#~event:config_object">config_object</a></li><li><a href="System.html#~event:config_set">config_set</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="System.html#~config_get-callback">config_get-callback</a></li><li><a href="System.html#~config_object-callback">config_object-callback</a></li></ul></div></li><li><a href="UserConfig.html">UserConfig</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UserConfig_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UserConfig.html#.Defaults">Defaults</a></li><li><a href="UserConfig.html#logSource">logSource</a></li><li><a href="UserConfig.html#registry">registry</a></li><li><a href="UserConfig.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UserConfig.html#bank">bank</a></li><li><a href="UserConfig.html#db">db</a></li><li><a href="UserConfig.html#deviceController">deviceController</a></li><li><a href="UserConfig.html#get">get</a></li><li><a href="UserConfig.html#getKey">getKey</a></li><li><a href="UserConfig.html#graphics">graphics</a></li><li><a href="UserConfig.html#instance">instance</a></li><li><a href="UserConfig.html#io">io</a></li><li><a href="UserConfig.html#log">log</a></li><li><a href="UserConfig.html#page">page</a></li><li><a href="UserConfig.html#schedule">schedule</a></li><li><a href="UserConfig.html#services">services</a></li><li><a href="UserConfig.html#setKey">setKey</a></li><li><a href="UserConfig.html#userconfig">userconfig</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * This file is part of the Companion project
 * Copyright (c) 2018 Bitfocus AS
 * Authors: William Viker &lt;william@bitfocus.io>, Håkon Nessjøen &lt;haakon@bitfocus.io>
 *
 * This program is free software.
 * You should have received a copy of the MIT licence as well as the Bitfocus
 * Individual Contributor License Agreement for companion along with
 * this program.
 *
 * You can be released from the requirements of the license by purchasing
 * a commercial license. Buying such a license is mandatory as soon as you
 * develop commercial activities involving the Companion software without
 * disclosing the source code of your own applications.
 *
 */

const fs = require('fs-extra')
const { cloneDeep } = require('lodash')

/**
 * Abstract class to be extended by the flat file DB classes.
 * See {@link Config} and {@link Database}
 *
 * @author Håkon Nessjøen &lt;haakon@bitfocus.io>
 * @author Keith Rocheck &lt;keith.rocheck@gmail.com>
 * @author William Viker &lt;william@bitfocus.io>
 * @since 2.3.0
 * @abstract
 */
class DataStoreBase {
	cfgDir = null
	cfgFile = null
	defaults = null
	dirty = false
	lastsave = Date.now()
	name = null
	saveInterval = null
	store = {}
	system = null

	/**
	 * Create a new flat file DB controller
	 * @param {EventEmitter} system - the application's event emitter
	 * @param {string} name - the name of the flat file
	 * @param {string} cfgDir - the directory the flat file will be saved
	 * @param {number} saveInterval - minimum interval in ms to save to disk
	 * @param {Object[]} defaults - the default data to use when making a new file
	 */
	constructor(system, name, cfgDir, saveInterval, defaults) {
		this.system = system
		this.name = name
		this.cfgDir = cfgDir
		this.cfgFile = cfgDir + '/' + name
		this.saveInterval = saveInterval
		this.defaults = defaults
	}

	/**
	 * Delete a key/value pair
	 * @param {string} key - the key to be delete
	 * @access public
	 */
	deleteKey(key) {
		this.debug(`${this.name}_del (${key})`)
		if (key !== undefined) {
			delete this.store[key]
			this.setDirty()
		}
	}

	/**
	 * Get the entire database
	 * @param {boolean} [clone = false] - `true` if a clone is needed instead of a link
	 * @returns {Object[]} the database
	 * @access public
	 */
	getAll(clone = false) {
		let out
		this.debug(`${this.name}_get_all`)

		if (clone === true) {
			out = cloneDeep(this.store)
		} else {
			out = this.store
		}

		return out
	}

	/**
	 * @returns {string} the directory of the flat file
	 * @access public
	 */
	getCfgDir() {
		return this.cfgDir
	}

	/**
	 * Get a value from the database
	 * @param {string} key - the key to be retrieved
	 * @param {?Object[]} defaultValue - the default value to use if the key doesn't exist
	 * @param {boolean} [clone = false] - `true` if a clone is needed instead of a link
	 * @access public
	 */
	getKey(key, defaultValue, clone = false) {
		let out
		this.debug(`${this.name}_get(${key})`)

		if (this.store[key] === undefined &amp;&amp; defaultValue !== undefined) {
			this.store[key] = defaultValue
			this.setDirty()
		}

		if (clone === true) {
			out = cloneDeep(this.store[key])
		} else {
			out = this.store[key]
		}

		return out
	}

	/**
	 * Attempt to load the database from disk
	 * @access protected
	 */
	load() {
		let cfgBakFile = this.cfgFile + '.bak'

		if (fs.existsSync(this.cfgFile)) {
			this.debug(this.cfgFile, 'exists. trying to read')
			let data = fs.readFileSync(this.cfgFile, 'utf8')

			try {
				if (data.trim().length > 0) {
					this.store = JSON.parse(data)
					this.debug('parsed JSON')
					this.system.emit(`${this.name}_loaded`, this.store)
				} else {
					this.system.emit(
						'log',
						this.name,
						'warn',
						`${this.name} was empty.  Attempting to recover the configuration.`
					)
					this.loadBackup(cfgBakFile)
				}
			} catch (e) {
				try {
					fs.copyFileSync(this.cfgFile, this.cfgFile + '.corrupt')
					this.system.emit(
						'log',
						this.name,
						'error',
						`${this.name} could not be parsed.  A copy has been saved to ${this.cfgFile}.corrupt.`
					)
					fs.rmSync(this.cfgFile)
				} catch (err) {
					this.debug(`${this.name}_load`, `Error making or deleting corrupted backup: ${err}`)
				}

				this.loadBackup(cfgBakFile)
			}
		} else if (fs.existsSync(cfgBakFile)) {
			this.system.emit('log', this.name, 'warn', `${this.name} is missing.  Attempting to recover the configuration.`)
			this.loadBackup(cfgBakFile)
		} else {
			this.loadDefaults()
		}

		this.setSaveCycle()
	}

	/**
	 * Attempt to load the backup file from disk as a recovery
	 * @param {string} cfgBakFile - the full file path
	 * @access protected
	 */
	loadBackup(cfgBakFile) {
		if (fs.existsSync(cfgBakFile)) {
			this.debug(cfgBakFile, 'exists. trying to read')
			let data = fs.readFileSync(cfgBakFile, 'utf8')

			try {
				if (data.trim().length > 0) {
					this.store = JSON.parse(data)
					this.debug('parsed JSON')
					this.system.emit('log', this.name, 'warn', `${this.name}.bak has been used to recover the configuration.`)
					this.system.emit(`${this.name}_loaded`, this.store)
					this.save(false)
				} else {
					this.loadDefaults()
				}
			} catch (e) {
				this.loadDefaults()
			}
		} else {
			this.loadDefaults()
		}
	}

	/**
	 * Save the defaults since a file could not be found/loaded/parses
	 * @access protected
	 */
	loadDefaults() {
		this.debug(this.cfgFile, 'didnt exist. loading defaults', this.defaults)
		this.system.emit(`${this.name}_loaded`, this.defaults)
		this.store = this.defaults
		this.save()
	}

	/**
	 * Save the database to file
	 * @param {boolean} [withBackup = true] - can be set to `false` if the current file should not be moved to `FILE.bak`
	 * @access protected
	 */
	save(withBackup = true) {
		if (withBackup === true &amp;&amp; fs.existsSync(this.cfgFile) &amp;&amp; fs.readFileSync(this.cfgFile, 'utf8').trim().length > 0) {
			fs.copy(this.cfgFile, this.cfgFile + '.bak', (err) => {
				if (err) {
					this.debug(`${this.name}_save`, `Error making backup copy: ${err}`)
				} else {
					this.debug(`${this.name}_save`, `backup written`)
				}

				this.saveMain()
			})
		} else {
			this.saveMain()
		}
	}

	/**
	 * Save the database to file making a `FILE.bak` version then moving it into place
	 * @access protected
	 */
	saveMain() {
		fs.writeFile(this.cfgFile + '.tmp', JSON.stringify(this.store), (err) => {
			if (err) {
				this.debug(`${this.name}_save`, `Error saving: ${err}`)
				return
			}

			this.debug(`${this.name}_save`, 'written')

			fs.rename(this.cfgFile + '.tmp', this.cfgFile, (err) => {
				if (err) {
					this.system.emit('log', this.name, 'error', `${this.name}.tmp->${this.name} failed: ${err}`)
				} else {
					this.debug(`${this.name}_save`, 'renamed')

					this.dirty = false
					this.lastsave = Date.now()
				}
			})
		})
	}

	/**
	 * Register that there are changes in the database that need to be saved as soon as possible
	 * @access public
	 */
	setDirty() {
		this.dirty = true
	}

	/**
	 * Save/update a key/value pair to the database
	 * @param {(number|string)} key - the key to save under
	 * @param {Object} value - the object to save
	 * @access public
	 */
	setKey(key, value) {
		this.debug(`${this.name}_set(${key}, ${value})`)

		if (key !== undefined) {
			this.store[key] = value
			this.setDirty()
		}
	}

	/**
	 * Save/update multiple key/value pairs to the database
	 * @param {Array.&lt;(number|string),Object>} keyvalueobj - the key to save under
	 * @access public
	 */
	setKeys(keyvalueobj) {
		this.debug(`${this.name}_set_multiple:`)

		if (keyvalueobj !== undefined &amp;&amp; typeof keyvalueobj == 'object' &amp;&amp; keyvalueobj.length > 0) {
			for (let key in keyvalueobj) {
				this.debug(`${this.name}_set(${key}, ${keyvalueobj[key]})`)
				this.store[key] = keyvalueobj[key]
			}

			this.setDirty()
		}
	}

	/**
	 * Setup the save cycle interval
	 * @access protected
	 */
	setSaveCycle() {
		this.saveCycle = setInterval(() => {
			// See if the database is dirty and needs to be saved
			if (Date.now() - this.lastsave > this.saveInterval &amp;&amp; this.dirty) {
				this.save()
			}
		}, this.saveInterval)
	}
}

exports = module.exports = DataStoreBase
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://bitfocus.io/images/topbar-logowhite.png" style="width: 147px; height: 24px">
    <div class="footer-text"> </div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
