

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: Graphics/Image.js | Companion</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 147px; height: 24px">
        
            <a href="https://bitfocus.io" rel="noopener noreferrer" target="_blank">
                <img src="https://bitfocus.io/images/topbar-logowhite.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Companion</a></h1>
        
            <span class="version">v2.3.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="BankActionController.html">BankActionController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankActionController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankActionController.html#actions">actions</a></li><li><a href="BankActionController.html#actionsRunning">actionsRunning</a></li><li><a href="BankActionController.html#bank">bank</a></li><li><a href="BankActionController.html#bankStatus">bankStatus</a></li><li><a href="BankActionController.html#config">config</a></li><li><a href="BankActionController.html#db">db</a></li><li><a href="BankActionController.html#debug">debug</a></li><li><a href="BankActionController.html#definitions">definitions</a></li><li><a href="BankActionController.html#deviceController">deviceController</a></li><li><a href="BankActionController.html#graphics">graphics</a></li><li><a href="BankActionController.html#instance">instance</a></li><li><a href="BankActionController.html#io">io</a></li><li><a href="BankActionController.html#logSource">logSource</a></li><li><a href="BankActionController.html#page">page</a></li><li><a href="BankActionController.html#.PageStyles">PageStyles</a></li><li><a href="BankActionController.html#registry">registry</a></li><li><a href="BankActionController.html#releaseActions">releaseActions</a></li><li><a href="BankActionController.html#schedule">schedule</a></li><li><a href="BankActionController.html#services">services</a></li><li><a href="BankActionController.html#skipNext">skipNext</a></li><li><a href="BankActionController.html#skipUp">skipUp</a></li><li><a href="BankActionController.html#system">system</a></li><li><a href="BankActionController.html#timersRunning">timersRunning</a></li><li><a href="BankActionController.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankActionController.html#log">log</a></li></ul></div></li><li><a href="BankActionDefinition.html">BankActionDefinition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankActionDefinition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankActionDefinition.html#label">label</a></li><li><a href="BankActionDefinition.html#options">options</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankActionDefinition.html#callback">callback</a></li><li><a href="BankActionDefinition.html#subscribe">subscribe</a></li><li><a href="BankActionDefinition.html#unsubscribe">unsubscribe</a></li></ul></div></li><li><a href="BankActionItems.html">BankActionItems</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankActionItems_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankActionItems.html#bank">bank</a></li><li><a href="BankActionItems.html#config">config</a></li><li><a href="BankActionItems.html#controller">controller</a></li><li><a href="BankActionItems.html#db">db</a></li><li><a href="BankActionItems.html#dbKey">dbKey</a></li><li><a href="BankActionItems.html#debug">debug</a></li><li><a href="BankActionItems.html#definitions">definitions</a></li><li><a href="BankActionItems.html#deviceController">deviceController</a></li><li><a href="BankActionItems.html#graphics">graphics</a></li><li><a href="BankActionItems.html#instance">instance</a></li><li><a href="BankActionItems.html#io">io</a></li><li><a href="BankActionItems.html#items">items</a></li><li><a href="BankActionItems.html#logSource">logSource</a></li><li><a href="BankActionItems.html#page">page</a></li><li><a href="BankActionItems.html#registry">registry</a></li><li><a href="BankActionItems.html#schedule">schedule</a></li><li><a href="BankActionItems.html#services">services</a></li><li><a href="BankActionItems.html#system">system</a></li><li><a href="BankActionItems.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankActionItems.html#addItem">addItem</a></li><li><a href="BankActionItems.html#addItemByClient">addItemByClient</a></li><li><a href="BankActionItems.html#checkBankExists">checkBankExists</a></li><li><a href="BankActionItems.html#checkBankStatus">checkBankStatus</a></li><li><a href="BankActionItems.html#checkInstanceStatus">checkInstanceStatus</a></li><li><a href="BankActionItems.html#checkStatus">checkStatus</a></li><li><a href="BankActionItems.html#cleanupItems">cleanupItems</a></li><li><a href="BankActionItems.html#deleteInstance">deleteInstance</a></li><li><a href="BankActionItems.html#deleteItem">deleteItem</a></li><li><a href="BankActionItems.html#deleteItemByClient">deleteItemByClient</a></li><li><a href="BankActionItems.html#getAll">getAll</a></li><li><a href="BankActionItems.html#getBank">getBank</a></li><li><a href="BankActionItems.html#getBankByClient">getBankByClient</a></li><li><a href="BankActionItems.html#getInstanceItems">getInstanceItems</a></li><li><a href="BankActionItems.html#getPage">getPage</a></li><li><a href="BankActionItems.html#importBank">importBank</a></li><li><a href="BankActionItems.html#log">log</a></li><li><a href="BankActionItems.html#resetBank">resetBank</a></li><li><a href="BankActionItems.html#save">save</a></li><li><a href="BankActionItems.html#setDefinitions">setDefinitions</a></li><li><a href="BankActionItems.html#subscribe">subscribe</a></li><li><a href="BankActionItems.html#subscribeBank">subscribeBank</a></li><li><a href="BankActionItems.html#unsubscribe">unsubscribe</a></li><li><a href="BankActionItems.html#unsubscribeBank">unsubscribeBank</a></li><li><a href="BankActionItems.html#updateItemDelay">updateItemDelay</a></li><li><a href="BankActionItems.html#updateItemOption">updateItemOption</a></li><li><a href="BankActionItems.html#updateItemOrder">updateItemOrder</a></li></ul></div></li><li><a href="BankController.html">BankController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankController.html#actions">actions</a></li><li><a href="BankController.html#bank">bank</a></li><li><a href="BankController.html#config">config</a></li><li><a href="BankController.html#db">db</a></li><li><a href="BankController.html#debug">debug</a></li><li><a href="BankController.html#deviceController">deviceController</a></li><li><a href="BankController.html#feedback">feedback</a></li><li><a href="BankController.html#fields">fields</a></li><li><a href="BankController.html#graphics">graphics</a></li><li><a href="BankController.html#instance">instance</a></li><li><a href="BankController.html#io">io</a></li><li><a href="BankController.html#logSource">logSource</a></li><li><a href="BankController.html#page">page</a></li><li><a href="BankController.html#registry">registry</a></li><li><a href="BankController.html#schedule">schedule</a></li><li><a href="BankController.html#services">services</a></li><li><a href="BankController.html#system">system</a></li><li><a href="BankController.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankController.html#log">log</a></li></ul></div></li><li><a href="BankFeedbackController.html">BankFeedbackController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankFeedbackController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankFeedbackController.html#bank">bank</a></li><li><a href="BankFeedbackController.html#config">config</a></li><li><a href="BankFeedbackController.html#db">db</a></li><li><a href="BankFeedbackController.html#debug">debug</a></li><li><a href="BankFeedbackController.html#deviceController">deviceController</a></li><li><a href="BankFeedbackController.html#graphics">graphics</a></li><li><a href="BankFeedbackController.html#instance">instance</a></li><li><a href="BankFeedbackController.html#io">io</a></li><li><a href="BankFeedbackController.html#logSource">logSource</a></li><li><a href="BankFeedbackController.html#page">page</a></li><li><a href="BankFeedbackController.html#registry">registry</a></li><li><a href="BankFeedbackController.html#schedule">schedule</a></li><li><a href="BankFeedbackController.html#services">services</a></li><li><a href="BankFeedbackController.html#system">system</a></li><li><a href="BankFeedbackController.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankFeedbackController.html#log">log</a></li></ul></div></li><li><a href="BankFeedbackDefinition.html">BankFeedbackDefinition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankFeedbackDefinition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankFeedbackDefinition.html#description">description</a></li><li><a href="BankFeedbackDefinition.html#label">label</a></li><li><a href="BankFeedbackDefinition.html#options">options</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankFeedbackDefinition.html#callback">callback</a></li><li><a href="BankFeedbackDefinition.html#subscribe">subscribe</a></li><li><a href="BankFeedbackDefinition.html#unsubscribe">unsubscribe</a></li></ul></div></li><li><a href="BankFeedbackItems.html">BankFeedbackItems</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankFeedbackItems_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankFeedbackItems.html#bank">bank</a></li><li><a href="BankFeedbackItems.html#config">config</a></li><li><a href="BankFeedbackItems.html#controller">controller</a></li><li><a href="BankFeedbackItems.html#db">db</a></li><li><a href="BankFeedbackItems.html#dbKey">dbKey</a></li><li><a href="BankFeedbackItems.html#debug">debug</a></li><li><a href="BankFeedbackItems.html#definitions">definitions</a></li><li><a href="BankFeedbackItems.html#deviceController">deviceController</a></li><li><a href="BankFeedbackItems.html#graphics">graphics</a></li><li><a href="BankFeedbackItems.html#instance">instance</a></li><li><a href="BankFeedbackItems.html#io">io</a></li><li><a href="BankFeedbackItems.html#items">items</a></li><li><a href="BankFeedbackItems.html#logSource">logSource</a></li><li><a href="BankFeedbackItems.html#page">page</a></li><li><a href="BankFeedbackItems.html#registry">registry</a></li><li><a href="BankFeedbackItems.html#schedule">schedule</a></li><li><a href="BankFeedbackItems.html#services">services</a></li><li><a href="BankFeedbackItems.html#system">system</a></li><li><a href="BankFeedbackItems.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankFeedbackItems.html#addItem">addItem</a></li><li><a href="BankFeedbackItems.html#addItemByClient">addItemByClient</a></li><li><a href="BankFeedbackItems.html#checkBankExists">checkBankExists</a></li><li><a href="BankFeedbackItems.html#checkBankStatus">checkBankStatus</a></li><li><a href="BankFeedbackItems.html#checkInstanceStatus">checkInstanceStatus</a></li><li><a href="BankFeedbackItems.html#checkStatus">checkStatus</a></li><li><a href="BankFeedbackItems.html#cleanupItems">cleanupItems</a></li><li><a href="BankFeedbackItems.html#deleteInstance">deleteInstance</a></li><li><a href="BankFeedbackItems.html#deleteItem">deleteItem</a></li><li><a href="BankFeedbackItems.html#deleteItemByClient">deleteItemByClient</a></li><li><a href="BankFeedbackItems.html#getAll">getAll</a></li><li><a href="BankFeedbackItems.html#getBank">getBank</a></li><li><a href="BankFeedbackItems.html#getBankByClient">getBankByClient</a></li><li><a href="BankFeedbackItems.html#getBankStyles">getBankStyles</a></li><li><a href="BankFeedbackItems.html#getInstanceItems">getInstanceItems</a></li><li><a href="BankFeedbackItems.html#getPage">getPage</a></li><li><a href="BankFeedbackItems.html#getStyle">getStyle</a></li><li><a href="BankFeedbackItems.html#importBank">importBank</a></li><li><a href="BankFeedbackItems.html#log">log</a></li><li><a href="BankFeedbackItems.html#resetBank">resetBank</a></li><li><a href="BankFeedbackItems.html#save">save</a></li><li><a href="BankFeedbackItems.html#setDefinitions">setDefinitions</a></li><li><a href="BankFeedbackItems.html#setStyle">setStyle</a></li><li><a href="BankFeedbackItems.html#subscribe">subscribe</a></li><li><a href="BankFeedbackItems.html#subscribeBank">subscribeBank</a></li><li><a href="BankFeedbackItems.html#unsubscribe">unsubscribe</a></li><li><a href="BankFeedbackItems.html#unsubscribeBank">unsubscribeBank</a></li><li><a href="BankFeedbackItems.html#updateItemOption">updateItemOption</a></li><li><a href="BankFeedbackItems.html#updateItemOrder">updateItemOrder</a></li></ul></div></li><li><a href="BankItemDefinition.html">BankItemDefinition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankItemDefinition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankItemDefinition.html#label">label</a></li><li><a href="BankItemDefinition.html#options">options</a></li></ul></div></li><li><a href="BankItemsBase.html">BankItemsBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankItemsBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankItemsBase.html#bank">bank</a></li><li><a href="BankItemsBase.html#config">config</a></li><li><a href="BankItemsBase.html#controller">controller</a></li><li><a href="BankItemsBase.html#db">db</a></li><li><a href="BankItemsBase.html#dbKey">dbKey</a></li><li><a href="BankItemsBase.html#definitions">definitions</a></li><li><a href="BankItemsBase.html#deviceController">deviceController</a></li><li><a href="BankItemsBase.html#graphics">graphics</a></li><li><a href="BankItemsBase.html#instance">instance</a></li><li><a href="BankItemsBase.html#io">io</a></li><li><a href="BankItemsBase.html#items">items</a></li><li><a href="BankItemsBase.html#logSource">logSource</a></li><li><a href="BankItemsBase.html#page">page</a></li><li><a href="BankItemsBase.html#registry">registry</a></li><li><a href="BankItemsBase.html#schedule">schedule</a></li><li><a href="BankItemsBase.html#services">services</a></li><li><a href="BankItemsBase.html#system">system</a></li><li><a href="BankItemsBase.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="BankItemsBase.html#addItem">addItem</a></li><li><a href="BankItemsBase.html#addItemByClient">addItemByClient</a></li><li><a href="BankItemsBase.html#checkBankExists">checkBankExists</a></li><li><a href="BankItemsBase.html#checkInstanceStatus">checkInstanceStatus</a></li><li><a href="BankItemsBase.html#checkStatus">checkStatus</a></li><li><a href="BankItemsBase.html#cleanupItems">cleanupItems</a></li><li><a href="BankItemsBase.html#deleteInstance">deleteInstance</a></li><li><a href="BankItemsBase.html#deleteItem">deleteItem</a></li><li><a href="BankItemsBase.html#deleteItemByClient">deleteItemByClient</a></li><li><a href="BankItemsBase.html#getAll">getAll</a></li><li><a href="BankItemsBase.html#getBank">getBank</a></li><li><a href="BankItemsBase.html#getBankByClient">getBankByClient</a></li><li><a href="BankItemsBase.html#getInstanceItems">getInstanceItems</a></li><li><a href="BankItemsBase.html#getPage">getPage</a></li><li><a href="BankItemsBase.html#importBank">importBank</a></li><li><a href="BankItemsBase.html#log">log</a></li><li><a href="BankItemsBase.html#resetBank">resetBank</a></li><li><a href="BankItemsBase.html#save">save</a></li><li><a href="BankItemsBase.html#setDefinitions">setDefinitions</a></li><li><a href="BankItemsBase.html#subscribe">subscribe</a></li><li><a href="BankItemsBase.html#subscribeBank">subscribeBank</a></li><li><a href="BankItemsBase.html#unsubscribe">unsubscribe</a></li><li><a href="BankItemsBase.html#unsubscribeBank">unsubscribeBank</a></li><li><a href="BankItemsBase.html#updateItemOption">updateItemOption</a></li><li><a href="BankItemsBase.html#updateItemOrder">updateItemOrder</a></li></ul></div></li><li><a href="BankStyle.html">BankStyle</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="BankStyle_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="BankStyle.html#alignment">alignment</a></li><li><a href="BankStyle.html#base64">base64</a></li><li><a href="BankStyle.html#bgcolor">bgcolor</a></li><li><a href="BankStyle.html#color">color</a></li><li><a href="BankStyle.html#png64">png64</a></li><li><a href="BankStyle.html#pngalignment">pngalignment</a></li><li><a href="BankStyle.html#size">size</a></li><li><a href="BankStyle.html#text">text</a></li></ul></div></li><li><a href="Config.html">Config</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Config_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Config.html#bank">bank</a></li><li><a href="Config.html#cfgDir">cfgDir</a></li><li><a href="Config.html#config">config</a></li><li><a href="Config.html#db">db</a></li><li><a href="Config.html#debug">debug</a></li><li><a href="Config.html#deviceController">deviceController</a></li><li><a href="Config.html#graphics">graphics</a></li><li><a href="Config.html#instance">instance</a></li><li><a href="Config.html#io">io</a></li><li><a href="Config.html#logSource">logSource</a></li><li><a href="Config.html#page">page</a></li><li><a href="Config.html#registry">registry</a></li><li><a href="Config.html#.SaveInterval">SaveInterval</a></li><li><a href="Config.html#schedule">schedule</a></li><li><a href="Config.html#services">services</a></li><li><a href="Config.html#system">system</a></li><li><a href="Config.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Config.html#deleteKey">deleteKey</a></li><li><a href="Config.html#doSave">doSave</a></li><li><a href="Config.html#getAll">getAll</a></li><li><a href="Config.html#getKey">getKey</a></li><li><a href="Config.html#loadBackupSync">loadBackupSync</a></li><li><a href="Config.html#loadDefaults">loadDefaults</a></li><li><a href="Config.html#loadSync">loadSync</a></li><li><a href="Config.html#log">log</a></li><li><a href="Config.html#save">save</a></li><li><a href="Config.html#saveImmediate">saveImmediate</a></li><li><a href="Config.html#setDirty">setDirty</a></li><li><a href="Config.html#setKey">setKey</a></li><li><a href="Config.html#setKeys">setKeys</a></li><li><a href="Config.html#setSaveCycle">setSaveCycle</a></li></ul></div></li><li><a href="CoreBase.html">CoreBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CoreBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CoreBase.html#bank">bank</a></li><li><a href="CoreBase.html#config">config</a></li><li><a href="CoreBase.html#db">db</a></li><li><a href="CoreBase.html#deviceController">deviceController</a></li><li><a href="CoreBase.html#graphics">graphics</a></li><li><a href="CoreBase.html#instance">instance</a></li><li><a href="CoreBase.html#io">io</a></li><li><a href="CoreBase.html#logSource">logSource</a></li><li><a href="CoreBase.html#page">page</a></li><li><a href="CoreBase.html#registry">registry</a></li><li><a href="CoreBase.html#schedule">schedule</a></li><li><a href="CoreBase.html#services">services</a></li><li><a href="CoreBase.html#system">system</a></li><li><a href="CoreBase.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="CoreBase.html#log">log</a></li></ul></div></li><li><a href="Database.html">Database</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Database_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Database.html#bank">bank</a></li><li><a href="Database.html#cfgDir">cfgDir</a></li><li><a href="Database.html#config">config</a></li><li><a href="Database.html#db">db</a></li><li><a href="Database.html#debug">debug</a></li><li><a href="Database.html#deviceController">deviceController</a></li><li><a href="Database.html#graphics">graphics</a></li><li><a href="Database.html#instance">instance</a></li><li><a href="Database.html#io">io</a></li><li><a href="Database.html#logSource">logSource</a></li><li><a href="Database.html#page">page</a></li><li><a href="Database.html#registry">registry</a></li><li><a href="Database.html#.SaveInterval">SaveInterval</a></li><li><a href="Database.html#schedule">schedule</a></li><li><a href="Database.html#services">services</a></li><li><a href="Database.html#system">system</a></li><li><a href="Database.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Database.html#deleteKey">deleteKey</a></li><li><a href="Database.html#doSave">doSave</a></li><li><a href="Database.html#getAll">getAll</a></li><li><a href="Database.html#getKey">getKey</a></li><li><a href="Database.html#loadBackupSync">loadBackupSync</a></li><li><a href="Database.html#loadDefaults">loadDefaults</a></li><li><a href="Database.html#loadSync">loadSync</a></li><li><a href="Database.html#log">log</a></li><li><a href="Database.html#save">save</a></li><li><a href="Database.html#saveImmediate">saveImmediate</a></li><li><a href="Database.html#setDirty">setDirty</a></li><li><a href="Database.html#setKey">setKey</a></li><li><a href="Database.html#setKeys">setKeys</a></li><li><a href="Database.html#setSaveCycle">setSaveCycle</a></li></ul></div></li><li><a href="DataStoreBase.html">DataStoreBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DataStoreBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="DataStoreBase.html#bank">bank</a></li><li><a href="DataStoreBase.html#cfgDir">cfgDir</a></li><li><a href="DataStoreBase.html#config">config</a></li><li><a href="DataStoreBase.html#db">db</a></li><li><a href="DataStoreBase.html#deviceController">deviceController</a></li><li><a href="DataStoreBase.html#graphics">graphics</a></li><li><a href="DataStoreBase.html#instance">instance</a></li><li><a href="DataStoreBase.html#io">io</a></li><li><a href="DataStoreBase.html#logSource">logSource</a></li><li><a href="DataStoreBase.html#page">page</a></li><li><a href="DataStoreBase.html#registry">registry</a></li><li><a href="DataStoreBase.html#schedule">schedule</a></li><li><a href="DataStoreBase.html#services">services</a></li><li><a href="DataStoreBase.html#system">system</a></li><li><a href="DataStoreBase.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="DataStoreBase.html#deleteKey">deleteKey</a></li><li><a href="DataStoreBase.html#doSave">doSave</a></li><li><a href="DataStoreBase.html#getAll">getAll</a></li><li><a href="DataStoreBase.html#getKey">getKey</a></li><li><a href="DataStoreBase.html#loadBackupSync">loadBackupSync</a></li><li><a href="DataStoreBase.html#loadDefaults">loadDefaults</a></li><li><a href="DataStoreBase.html#loadSync">loadSync</a></li><li><a href="DataStoreBase.html#log">log</a></li><li><a href="DataStoreBase.html#save">save</a></li><li><a href="DataStoreBase.html#saveImmediate">saveImmediate</a></li><li><a href="DataStoreBase.html#setDirty">setDirty</a></li><li><a href="DataStoreBase.html#setKey">setKey</a></li><li><a href="DataStoreBase.html#setKeys">setKeys</a></li><li><a href="DataStoreBase.html#setSaveCycle">setSaveCycle</a></li></ul></div></li><li><a href="InterfaceClient.html">InterfaceClient</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="InterfaceClient_sub"><div class="member-type">Events</div><ul class="inner"><li><a href="InterfaceClient.html#~event:get_userconfig_all">get_userconfig_all</a></li><li><a href="InterfaceClient.html#~event:set_userconfig_key">set_userconfig_key</a></li><li><a href="InterfaceClient.html#~event:set_userconfig_key:result">set_userconfig_key:result</a></li></ul></div></li><li><a href="Registry.html">Registry</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Registry_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Registry.html#appRoot">appRoot</a></li><li><a href="Registry.html#bindIp">bindIp</a></li><li><a href="Registry.html#bindPort">bindPort</a></li><li><a href="Registry.html#buildNumber">buildNumber</a></li><li><a href="Registry.html#cfgDir">cfgDir</a></li><li><a href="Registry.html#debug">debug</a></li><li><a href="Registry.html#fileVersion">fileVersion</a></li><li><a href="Registry.html#logbuffer">logbuffer</a></li><li><a href="Registry.html#logwriting">logwriting</a></li><li><a href="Registry.html#pkgInfo">pkgInfo</a></li><li><a href="Registry.html#skeletonInfo">skeletonInfo</a></li><li><a href="Registry.html#startMinimised">startMinimised</a></li><li><a href="Registry.html#system">system</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Registry.html#exit">exit</a></li><li><a href="Registry.html#launch">launch</a></li><li><a href="Registry.html#quit">quit</a></li><li><a href="Registry.html#restart">restart</a></li><li><a href="Registry.html#startLogging">startLogging</a></li></ul></div></li><li><a href="ScheduleController.html">ScheduleController</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ScheduleController_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ScheduleController.html#bank">bank</a></li><li><a href="ScheduleController.html#config">config</a></li><li><a href="ScheduleController.html#db">db</a></li><li><a href="ScheduleController.html#debug">debug</a></li><li><a href="ScheduleController.html#deviceController">deviceController</a></li><li><a href="ScheduleController.html#graphics">graphics</a></li><li><a href="ScheduleController.html#instance">instance</a></li><li><a href="ScheduleController.html#io">io</a></li><li><a href="ScheduleController.html#logSource">logSource</a></li><li><a href="ScheduleController.html#page">page</a></li><li><a href="ScheduleController.html#registry">registry</a></li><li><a href="ScheduleController.html#schedule">schedule</a></li><li><a href="ScheduleController.html#services">services</a></li><li><a href="ScheduleController.html#system">system</a></li><li><a href="ScheduleController.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ScheduleController.html#action">action</a></li><li><a href="ScheduleController.html#cleanConfig">cleanConfig</a></li><li><a href="ScheduleController.html#eventLoadType">eventLoadType</a></li><li><a href="ScheduleController.html#eventWatch">eventWatch</a></li><li><a href="ScheduleController.html#findEventIndex">findEventIndex</a></li><li><a href="ScheduleController.html#getBankButton">getBankButton</a></li><li><a href="ScheduleController.html#getNextId">getNextId</a></li><li><a href="ScheduleController.html#getPlugin">getPlugin</a></li><li><a href="ScheduleController.html#getSchedule">getSchedule</a></li><li><a href="ScheduleController.html#initConfig">initConfig</a></li><li><a href="ScheduleController.html#loadPlugins">loadPlugins</a></li><li><a href="ScheduleController.html#log">log</a></li><li><a href="ScheduleController.html#saveSchedule">saveSchedule</a></li><li><a href="ScheduleController.html#saveToDb">saveToDb</a></li><li><a href="ScheduleController.html#sendPlugins">sendPlugins</a></li><li><a href="ScheduleController.html#startSchedule">startSchedule</a></li><li><a href="ScheduleController.html#updateSchedule">updateSchedule</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="ScheduleController.html#~getSchedule-callback">getSchedule-callback</a></li><li><a href="ScheduleController.html#~saveSchedule-callback">saveSchedule-callback</a></li><li><a href="ScheduleController.html#~sendPlugins-callback">sendPlugins-callback</a></li><li><a href="ScheduleController.html#~updateSchedule-callback">updateSchedule-callback</a></li></ul></div></li><li><a href="SchedulePluginBase.html">SchedulePluginBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="SchedulePluginBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="SchedulePluginBase.html#multiple">multiple</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="SchedulePluginBase.html#add">add</a></li><li><a href="SchedulePluginBase.html#configDesc">configDesc</a></li><li><a href="SchedulePluginBase.html#frontEnd">frontEnd</a></li><li><a href="SchedulePluginBase.html#remove">remove</a></li><li><a href="SchedulePluginBase.html#setup">setup</a></li></ul></div></li><li><a href="ServiceBase.html">ServiceBase</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ServiceBase_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ServiceBase.html#bank">bank</a></li><li><a href="ServiceBase.html#config">config</a></li><li><a href="ServiceBase.html#db">db</a></li><li><a href="ServiceBase.html#deviceController">deviceController</a></li><li><a href="ServiceBase.html#graphics">graphics</a></li><li><a href="ServiceBase.html#instance">instance</a></li><li><a href="ServiceBase.html#io">io</a></li><li><a href="ServiceBase.html#logSource">logSource</a></li><li><a href="ServiceBase.html#page">page</a></li><li><a href="ServiceBase.html#registry">registry</a></li><li><a href="ServiceBase.html#schedule">schedule</a></li><li><a href="ServiceBase.html#services">services</a></li><li><a href="ServiceBase.html#system">system</a></li><li><a href="ServiceBase.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ServiceBase.html#disableModule">disableModule</a></li><li><a href="ServiceBase.html#enableModule">enableModule</a></li><li><a href="ServiceBase.html#handleSocketError">handleSocketError</a></li><li><a href="ServiceBase.html#init">init</a></li><li><a href="ServiceBase.html#log">log</a></li><li><a href="ServiceBase.html#setDefaults">setDefaults</a></li><li><a href="ServiceBase.html#updateUserconfig">updateUserconfig</a></li></ul></div></li><li><a href="UserConfig.html">UserConfig</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UserConfig_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UserConfig.html#bank">bank</a></li><li><a href="UserConfig.html#config">config</a></li><li><a href="UserConfig.html#db">db</a></li><li><a href="UserConfig.html#debug">debug</a></li><li><a href="UserConfig.html#.Defaults">Defaults</a></li><li><a href="UserConfig.html#deviceController">deviceController</a></li><li><a href="UserConfig.html#graphics">graphics</a></li><li><a href="UserConfig.html#instance">instance</a></li><li><a href="UserConfig.html#io">io</a></li><li><a href="UserConfig.html#logSource">logSource</a></li><li><a href="UserConfig.html#page">page</a></li><li><a href="UserConfig.html#registry">registry</a></li><li><a href="UserConfig.html#schedule">schedule</a></li><li><a href="UserConfig.html#services">services</a></li><li><a href="UserConfig.html#system">system</a></li><li><a href="UserConfig.html#userconfig">userconfig</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UserConfig.html#get">get</a></li><li><a href="UserConfig.html#getKey">getKey</a></li><li><a href="UserConfig.html#log">log</a></li><li><a href="UserConfig.html#setKey">setKey</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * This file is part of the Companion project
 * Copyright (c) 2018 Bitfocus AS
 * Authors: William Viker &lt;william@bitfocus.io>, Håkon Nessjøen &lt;haakon@bitfocus.io>
 *
 * This program is free software.
 * You should have received a copy of the MIT licence as well as the Bitfocus
 * Individual Contributor License Agreement for companion along with
 * this program.
 *
 * You can be released from the requirements of the license by purchasing
 * a commercial license. Buying such a license is mandatory as soon as you
 * develop commercial activities involving the Companion software without
 * disclosing the source code of your own applications.
 *
 */

// Super primitive drawing library!

var debug = require('debug')('Graphics/Image')
var fs = require('fs')
var PNG = require('pngjs').PNG
var font = require('./Font')()

class Image {
	constructor(width, height) {
		/* Defaults for custom images from modules */
		if (width === undefined) {
			width = 72
		}

		if (height === undefined) {
			height = 58
		}

		this.lastUpdate = Date.now()
		this.width = width
		this.height = height
		this.canvas = []
		this.lastBackgroundColor = Image.rgb(0, 0, 0)

		for (var y = 0; y &lt; this.height; y++) {
			var buf = Buffer.alloc(this.width * 3) // * 3 for RGB.
			this.canvas.push(buf)
		}
	}

	//-----------
	// Static methods are for backwards compatibility ... needs to be revisited
	//-----------

	static rgb(r, g, b) {
		r = parseInt(r, 16)
		g = parseInt(g, 16)
		b = parseInt(b, 16)

		if (isNaN(r) || isNaN(g) || isNaN(b)) {
			return false
		} else {
			return ((r &amp; 0xff) &lt;&lt; 16) | ((g &amp; 0xff) &lt;&lt; 8) | (b &amp; 0xff)
		}
	}

	static rgbRev(dec) {
		dec = Math.round(dec)

		return {
			r: (dec &amp; 0xff0000) >> 16,
			g: (dec &amp; 0x00ff00) >> 8,
			b: dec &amp; 0x0000ff,
		}
	}

	static argb(a, r, g, b) {
		a = parseInt(a, 16)
		r = parseInt(r, 16)
		g = parseInt(g, 16)
		b = parseInt(b, 16)

		if (isNaN(a) || isNaN(r) || isNaN(g) || isNaN(b)) {
			return false
		} else {
			// bitwise doesn't work because JS bitwise is working with 32bit signed int
			return a * 0x1000000 + Image.rgb(r, g, b)
		}
	}

	//-----------

	backgroundColor(backgroundColor) {
		this.lastBackgroundColor = backgroundColor

		for (var y = 0; y &lt; this.height; y++) {
			for (var x = 0; x &lt; this.width; x++) {
				this.pixel(x, y, backgroundColor)
			}
		}

		return true
	}

	boxFilled(x1, y1, x2, y2, color) {
		for (var y = y1; y &lt;= y2; y++) {
			for (var x = x1; x &lt;= x2; x++) {
				this.pixel(x, y, color)
			}
		}

		return true
	}

	boxLine(x1, y1, x2, y2, color) {
		for (var y = y1; y &lt;= y2; y++) {
			var line = this.canvas[y]

			// draw horizontal lines
			if (y == y1 || y == y2) {
				for (var x = x1; x &lt;= x2; x++) {
					this.pixel(x, y, color)
				}
			}

			// draw vertical lines
			if (y > y1 || y &lt; y2) {
				this.pixel(x1, y, color)
				this.pixel(x2, y, color)
			}
		}

		return true
	}

	buffer() {
		return Buffer.concat(this.canvas)
	}

	bufferAndTime() {
		return { updated: this.lastUpdate, buffer: this.buffer() }
	}

	/*
		Draws aligned text in an boxed area.
		int x: bounding box top left horizontal value
		int y: bounding box top left vertical value
		int w: bounding box width
		int h: bounding box height
		string text: the text to drawBank
		rgb-array color: color of the text
		string fontindex: index of font, either 'icon' or something else
		int spacing: how much space should be between letters, leave undefined for spacing of font
		int size: font size multiplier
		string halign: horizontal alignment left, center, right
		string valign: vertical alignment top, center, bottom
		bool dummy: don't actually draw anything if true, just return if the text fits

		returns true if text fits
	*/
	drawAlignedText(
		x = 0,
		y = 0,
		w = 72,
		h = 72,
		text,
		color,
		fontindex = '',
		spacing,
		size = 1,
		halign = 'center',
		valign = 'center',
		dummy = false
	) {
		var textFits = true
		var double
		var lineheight
		var linespacing
		var charspacing

		if (size === 2) {
			double = true
		} else {
			double = false
		}

		if (!font[fontindex]) {
			fontindex = 'auto'
		}

		if (fontindex === 'auto') {
			fontindex = 0

			for (let checksize of [44, 30, 24, 18, 14]) {
				if (this.drawAlignedText(x, y, w, h, text, color, checksize, spacing, size, halign, valign, true) === true) {
					fontindex = checksize
					break
				}
			}
		}

		lineheight = font[fontindex].lineheight
		linespacing = font[fontindex].linespacing

		if (spacing !== undefined) {
			charspacing = spacing
		} else {
			charspacing = font[fontindex].charspacing
		}

		var displayText = text.trim() // remove leading and trailing spaces for display

		var xSize = this.drawTextLine(0, 0, displayText, color, fontindex, charspacing, double, true)

		// breakup text in pieces
		var breakPos = [0]
		var lastBreakPos = 0
		var lineWidth = 0

		for (var i = 0; i &lt; displayText.length; i++) {
			if (
				displayText.charCodeAt(i) === 32 ||
				displayText.charCodeAt(i) === 45 ||
				displayText.charCodeAt(i) === 95 ||
				displayText.charCodeAt(i) === 58 ||
				displayText.charCodeAt(i) === 126
			) {
				lastBreakPos = i // remember the latest position where break is possible
			}

			// Support \n as line breaker
			if (displayText.substr(i, 2) === '\\n') {
				lastBreakPos = i
				displayText = displayText.slice(0, lastBreakPos) + displayText.slice(lastBreakPos + 2)
				i--
				breakPos.push(lastBreakPos)
				lastBreakPos = 0
			}

			if (
				this.drawTextLine(
					0,
					0,
					displayText.slice(breakPos[breakPos.length - 1], i + 1),
					color,
					fontindex,
					charspacing,
					double,
					true
				) > w
			) {
				if (lastBreakPos > 0) {
					// if line is getting too long and there was a good wrap position, wrap it at that position

					if (displayText.charCodeAt(lastBreakPos) === 32) {
						// if the break position was a space we want to get rid of it
						displayText = displayText.slice(0, lastBreakPos) + displayText.slice(lastBreakPos + 1)
						i--
					} else {
						if (i - lastBreakPos > 0) {
							// if we can afford we want to have the breaking character in the top line, otherwise it gets wrapped (ugly, but better for space usage)
							lastBreakPos += 1
						}
					}

					breakPos.push(lastBreakPos)
					lastBreakPos = 0
				} else {
					breakPos.push(i) // if there has been no good break position, just wrap it anyway
					lastBreakPos = 0
				}
			}
		}

		breakPos.push(displayText.length)

		var lines = breakPos.length - 1

		if (lines * lineheight * (double ? 2 : 1) + (lines - 1) * linespacing * (double ? 2 : 1) > h) {
			lines = parseInt((h + linespacing * (double ? 2 : 1)) / ((lineheight + linespacing) * (double ? 2 : 1)))
			textFits = false
		}

		if (lines === 0) {
			return true
		}

		if (dummy !== true) {
			for (var line = 1; line &lt;= lines; line++) {
				xSize = this.drawTextLine(
					0,
					0,
					displayText.slice(breakPos[line - 1], breakPos[line]),
					color,
					fontindex,
					charspacing,
					double,
					true
				)
				var xStart, yStart

				switch (halign) {
					case 'left':
						xStart = x
						break
					case 'center':
						xStart = x + parseInt((w - xSize) / 2)
						break
					case 'right':
						xStart = x + w - xSize
						break
				}

				switch (valign) {
					case 'top':
						yStart = y + (line - 1) * (lineheight + linespacing) * (double ? 2 : 1)
						break
					case 'center':
						yStart =
							y +
							parseInt(
								(h - (lines * lineheight * (double ? 2 : 1) + (lines - 1) * linespacing * (double ? 2 : 1))) / 2
							) +
							(line - 1) * (lineheight + linespacing) * (double ? 2 : 1)
						break
					case 'bottom':
						yStart = y + h - (lines - line + 1) * (lineheight + linespacing) * (double ? 2 : 1)
						break
				}

				var linetext = displayText.slice(breakPos[line - 1], breakPos[line])
				this.drawTextLine(xStart, yStart, linetext, color, fontindex, charspacing, double)
			}
		}

		return textFits
	}

	drawBorder(depth = 0, color) {
		if (depth > 0) {
			if (depth * 2 &lt; this.width) {
				for (var x = 0; x &lt; depth; x++) {
					this.verticalLine(x, color)
				}

				for (var x = this.width - depth; x &lt; this.width; x++) {
					this.verticalLine(x, color)
				}
			} else {
				for (var x = 0; x &lt; this.width; x++) {
					this.verticalLine(x, color)
				}
			}

			if (depth * 2 &lt; this.height) {
				for (var y = 0; y &lt; depth; y++) {
					this.horizontalLine(y, color)
				}

				for (var y = this.height - depth; y &lt; this.height; y++) {
					this.horizontalLine(y, color)
				}
			} else {
				for (var y = 0; y &lt; this.height; y++) {
					this.horizontalLine(y, color)
				}
			}

			this.pixel(depth + 1, depth + 1, color)
			this.pixel(this.width - depth - 1, depth + 1, color)
			this.pixel(depth + 1, this.height - depth - 1, color)
			this.pixel(this.width - depth - 1, this.height - depth - 1, color)

			return true
		} else {
			return false
		}
	}

	drawCenterText(x, y, text, color, fontindex, spacing, double) {
		/*
			DEPRECATED
			This Function doesn't work with UTF16 text.
			Use drawAlignedText instead
		*/
		if (text == undefined || text == '') {
			return 0
		}

		var xCenter = x
		var maxWidth = x * 2 // maximum line width is only correct if text center position is left of image center

		if (maxWidth > this.width) {
			// correction of line width if text center is right of image center
			maxWidth = (this.width - x) * 2
		}

		var displayText = text.trim() // remove leading and trailing spaces for display
		// do we have more then one line?
		var xSize = this.drawText(0, 0, displayText, color, fontindex, spacing, double, true)

		if (xSize > maxWidth) {
			// breakup text in pieces
			//const breakChars = '\s-~,';
			var breakPos = [0]
			var lastBreakPos = 0
			var lineWidth = 0

			for (var i = 0; i &lt; displayText.length; i++) {
				if (
					displayText.charCodeAt(i) == 32 ||
					displayText.charCodeAt(i) == 45 ||
					displayText.charCodeAt(i) == 95 ||
					displayText.charCodeAt(i) == 58 ||
					displayText.charCodeAt(i) == 126
				) {
					lastBreakPos = i // remember the latest position where break is possible
				}

				if (
					this.drawText(
						0,
						0,
						displayText.substr(breakPos[breakPos.length - 1], i + 1),
						color,
						fontindex,
						spacing,
						double,
						true
					) > maxWidth
				) {
					if (lastBreakPos > 0) {
						// if line is getting too long and there was a good wrap position, wrap it at that position

						if (displayText.charCodeAt(lastBreakPos) == 32) {
							// if the break position was a space we want to get rid of it
							displayText = displayText.slice(0, lastBreakPos) + displayText.slice(lastBreakPos + 1)
						} else {
							if (i - lastBreakPos > 0) {
								// if we can afford we want to have the breaking charakter in the top line, otherwise it gets wrapped (ugly, but better for space usage)
								lastBreakPos += 1
							}
						}

						breakPos.push(lastBreakPos)
					} else {
						breakPos.push(i - 1) // if there has been no good break position, just wrap it anyway
						lastBreakPos = 0
					}
				}
			}

			breakPos.push(displayText.length)

			for (var lines = 1; lines &lt; breakPos.length; lines++) {
				xSize = this.drawText(
					0,
					0,
					displayText.substr(breakPos[lines - 1], breakPos[lines]),
					color,
					fontindex,
					spacing,
					double,
					true
				)
				var xStart = parseInt(xCenter - xSize / 2)
				var yStart =
					y -
					parseInt(((breakPos.length - 1) * (double ? 14 : 7) + (breakPos.length - 2) * (double ? 4 : 2)) / 2) +
					(lines - 1) * (double ? 18 : 9)
				this.drawText(
					xStart,
					yStart,
					displayText.substr(breakPos[lines - 1], breakPos[lines]),
					color,
					fontindex,
					spacing,
					double
				)
			}
		} else {
			// just draw one line
			var xStart = parseInt(xCenter - xSize / 2)
			return this.drawText(xStart, y - (double ? 7 : 4), displayText, color, fontindex, spacing, double)
		}
	}

	drawChar(x, y, char, color, fontindex, double, dummy) {
		if (double === undefined) {
			double = false
		}

		if (char === undefined) {
			return 0
		}

		// dummy is for not drawing any actual pixels. just calculate the font size
		if (dummy === undefined) {
			dummy = false
		}

		if (char == 32 || char == 160) {
			// return blanks for space
			return 2
		}

		if (font[fontindex] === undefined) {
			return 0
		}

		if (char >= 0xd800 &amp;&amp; char &lt;= 0xdbff) {
			// most likely a lead surrogate of an UTF16 pair
			return 0
		}

		if (font[fontindex][char] === undefined) {
			debug('trying to draw a character that doesnt exist in the font:', char, String.fromCharCode(parseInt(char)))
			return 0
		}

		var gfx = font[fontindex][char]
		var maxX = 0

		for (var pixel in gfx) {
			if (double == true) {
				if ((gfx[pixel][0] + 1) * 2 > maxX) {
					maxX = (gfx[pixel][0] + 1) * 2
				}

				if (dummy == false) {
					for (var len = 0; len &lt; gfx[pixel][2]; len++) {
						this.pixel(x + gfx[pixel][0] * 2, y + (gfx[pixel][1] * 2 + len * 2), color)
						this.pixel(x + gfx[pixel][0] * 2 + 1, y + (gfx[pixel][1] * 2 + len * 2), color)
						this.pixel(x + gfx[pixel][0] * 2, y + gfx[pixel][1] * 2 + len * 2 + 1, color)
						this.pixel(x + gfx[pixel][0] * 2 + 1, y + gfx[pixel][1] * 2 + len * 2 + 1, color)
					}
				}
			} else {
				if (gfx[pixel][0] + 1 > maxX) {
					maxX = gfx[pixel][0] + 1
				}

				if (dummy == false) {
					for (var len = 0; len &lt; gfx[pixel][2]; len++) {
						this.pixel(x + gfx[pixel][0], y + gfx[pixel][1] + len, color)
					}
				}
			}
		}

		return maxX
	}

	drawCornerTriangle(depth = 0, color, halign = 'left', valign = 'top') {
		if (depth > 0 &amp;&amp; (halign == 'left' || halign == 'right') &amp;&amp; (valign == 'top' || valign == 'bottom')) {
			var maxY = depth > this.height ? this.height : depth

			for (var y = 0; y &lt; maxY; y++) {
				var trueY = valign == 'bottom' ? this.height - 1 - y : y

				for (var x = 0; x &lt; depth - y &amp;&amp; x &lt; this.width; x++) {
					var trueX = halign == 'right' ? this.width - 1 - x : x

					this.pixel(trueX, trueY, color)
				}
			}

			return true
		} else {
			return false
		}
	}

	drawFromPNG(file, xStart, yStart) {
		var data, png

		try {
			data = fs.readFileSync(file)
			png = this.drawFromPNGdata(data, xStart, yStart)
		} catch (e) {
			debug('Error opening image file: ' + file, e)
			return
		}
	}

	drawFromPNGdata(data, xStart = 0, yStart = 0, width = 72, height = 58, halign = 'center', valign = 'center') {
		var data, png
		var xouter, xinnner, youter, yinner, wouter, houter

		if (xStart + width > this.width) {
			width = this.width - xStart
		}

		if (yStart + height > this.height) {
			height = this.height - yStart
		}

		png = PNG.sync.read(data)

		if (png.width > width) {
			//image is broader than drawing pane
			switch (halign) {
				case 'left':
					xouter = 0
					xinner = 0
					wouter = width
					break
				case 'center':
					xouter = 0
					xinner = Math.round((png.width - width) / 2, 0)
					wouter = width
					break
				case 'right':
					xouter = 0
					xinner = png.width - width
					wouter = width
					break
			}
		} else {
			// image is narrower than drawing pane
			switch (halign) {
				case 'left':
					xouter = 0
					xinner = 0
					wouter = png.width
					break
				case 'center':
					xouter = Math.round((width - png.width) / 2, 0)
					xinner = 0
					wouter = png.width
					break
				case 'right':
					xouter = width - png.width
					xinner = 0
					wouter = png.width
					break
			}
		}

		if (png.height > height) {
			// image is taller than drawing pane
			switch (valign) {
				case 'top':
					youter = 0
					yinner = 0
					houter = height
					break
				case 'center':
					youter = 0
					yinner = Math.round((png.height - height) / 2, 0)
					houter = height
					break
				case 'bottom':
					youter = 0
					yinner = png.height - height
					houter = height
					break
			}
		} else {
			switch (
				valign // image is smaller than drawing pane
			) {
				case 'top':
					youter = 0
					yinner = 0
					houter = png.height
					break
				case 'center':
					youter = Math.round((height - png.height) / 2, 0)
					yinner = 0
					houter = png.height
					break
				case 'bottom':
					youter = height - png.height
					yinner = 0
					houter = png.height
					break
			}
		}

		for (var y = 0; y &lt; houter; y++) {
			for (var x = 0; x &lt; wouter; x++) {
				var idx = (png.width * (y + yinner) + x + xinner) &lt;&lt; 2
				var r = png.data[idx]
				var g = png.data[idx + 1]
				var b = png.data[idx + 2]
				var a = png.data[idx + 3]

				if (png.data[idx + 3] > 0) {
					if (png.data[idx + 3] === 256) {
						this.pixel(xStart + xouter + x, yStart + youter + y, Image.rgb(r, g, b))
					} else {
						this.pixel(xStart + xouter + x, yStart + youter + y, Image.argb(a, r, g, b))
					}
				}
			}
		}
	}

	drawLetter(x, y, letter, color, fontindex, double, dummy) {
		/*
			DEPRECATED
			This Function doesn't work with UTF16 chars
			Use drawChar instead
		*/
		if (double === undefined) {
			double = false
		}

		if (letter === undefined || ((letter.length > 1 || letter.length == 0) &amp;&amp; letter == 'icon')) {
			return 0
		}

		// dummy is for not drawing any actual pixels. just calculate the font size
		if (dummy === undefined) {
			dummy = false
		}

		var num

		if (fontindex !== 'icon') {
			num = letter.charCodeAt(0)
		} else {
			num = letter
		}

		return this.drawChar(x, y, num, color, fontindex, double, dummy)
	}

	/**
	 * drawPixeBuffer(x, y, width, height, buffer[, type])
	 *
	 * Buffer can be either a buffer, or base64 encoded string.
	 * Type can be set to either 'buffer' or 'base64' according to your input data.
	 * Width and height is information about your buffer, not scaling.
	 *
	 * The buffer data is expected to be RGB or ARGB data, 1 byte per color,
	 * horizontally. Top left is first three bytes.
	 */
	drawPixelBuffer(x, y, width, height, buffer, type) {
		if (type === undefined &amp;&amp; typeof buffer == 'object' &amp;&amp; buffer instanceof Buffer) {
			type = 'buffer'
		} else if (type === undefined &amp;&amp; typeof buffer == 'string') {
			type = 'base64'
		}

		if (type === 'base64') {
			buffer = Buffer.from(buffer, 'base64')
		}

		if (buffer.length &lt; width * height * 3) {
			throw new Error(
				'Pixelbuffer of ' + buffer.length + ' bytes is less than expected ' + width * height * 3 + ' bytes'
			)
			return
		}

		if (buffer.length == width * height * 4) {
			// ARGB
			var counter = 0

			for (var y2 = 0; y2 &lt; height; ++y2) {
				for (var x2 = 0; x2 &lt; width; ++x2) {
					var color = buffer.readUInt32BE(counter)
					this.pixel(x + x2, y + y2, color)
					counter += 4
				}
			}
		} else if (buffer.length == width * height * 3) {
			// RGB
			var counter = 0
			for (var y2 = 0; y2 &lt; height; ++y2) {
				for (var x2 = 0; x2 &lt; width; ++x2) {
					var color = buffer.readUIntBE(counter, 3)
					this.pixel(x + x2, y + y2, color)
					counter += 3
				}
			}
		} else {
			throw new Error(
				'Pixelbuffer for a ' +
					width +
					'x' +
					height +
					' image should be either ' +
					width * height * 3 +
					' or ' +
					width * height * 4 +
					' bytes big. Not ' +
					buffer.length
			)
		}
	}

	drawText(x, y, text, color, fontindex, spacing, double, dummy) {
		/*
			DEPRECATED
			This function has several problems
			Use drawTextLine or drawAlignedText instead
		*/
		if (text === undefined || text.length == 0) {
			return 0
		}

		if (spacing === undefined) {
			spacing = 2
		}

		if (double === undefined) {
			double = false
		}

		var chars = text.split('')
		var max_x = 0
		var x_pos = 0
		var y_pos = y
		var just_wrapped = true

		for (var i in chars) {
			if (x + x_pos > this.width - (double ? 16 : 8) &amp;&amp; dummy != true) {
				x_pos = 0
				y_pos += double ? 18 : 9
				just_wrapped = true
			}

			if (!(chars[i] == ' ' &amp;&amp; just_wrapped == true)) {
				x_pos += (double ? 4 : 2) + this.drawLetter(x + x_pos, y_pos, chars[i], color, fontindex, double, dummy)
			}

			just_wrapped = false

			if (x_pos > max_x) {
				max_x = x_pos
			}
		}

		return max_x
	}

	drawTextLine(x, y, text, color, fontindex, spacing, double, dummy) {
		if (text === undefined || text.length == 0) {
			return 0
		}

		if (spacing === undefined) {
			spacing = 2
		}

		if (double === undefined) {
			double = false
		}

		var chars = text.split('')
		var max_x = 0
		var x_pos = 0
		var y_pos = y

		for (var i = 0; i &lt; chars.length; i++) {
			var charcode = chars[i].charCodeAt(0)
			if (charcode >= 0xd800 &amp;&amp; charcode &lt;= 0xdbff &amp;&amp; chars.length - 1 > i) {
				// check if this is the start of a surrogate pair
				var lead = charcode
				var tail = chars[i + 1].charCodeAt(0)

				if (tail >= 0xdc00 &amp;&amp; tail &lt;= 0xdfff) {
					// low surrogate
					charcode = (lead - 0xd800) * 0x400 + tail - 0xdc00 + 0x10000
					i++
				}
			}

			var width = this.drawChar(x + x_pos, y_pos, charcode, color, fontindex, double, dummy)
			x_pos += width ? width : 0

			if (i &lt; chars.length - 1) {
				x_pos += width ? (double ? spacing * 2 : spacing) : 0
			}

			if (x_pos > max_x) {
				max_x = x_pos
			}
		}

		return max_x
	}

	horizontalLine(y, color) {
		for (var x = 0; x &lt; this.width; x++) {
			this.pixel(x, y, color)
		}

		return true
	}

	pixel(x, y, color) {
		if (x >= this.width) {
			return
		}

		if (y >= this.height) {
			return
		}

		var line = this.canvas[y]

		if (color &lt;= 0xffffff) {
			line.writeUIntBE(color &amp; 0xffffff, x * 3, 3)
		} else {
			var alpha = Math.floor(color / 0x1000000) / 0xff
			var oldr = line.readUInt8(x * 3)
			var oldg = line.readUInt8(x * 3 + 1)
			var oldb = line.readUInt8(x * 3 + 2)
			var newr = (color >> 16) &amp; 0xff
			var newg = (color >> 8) &amp; 0xff
			var newb = color &amp; 0xff
			line.writeUIntBE(
				Image.rgb(
					oldr * (1 - alpha) + newr * alpha,
					oldg * (1 - alpha) + newg * alpha,
					oldb * (1 - alpha) + newb * alpha
				),
				x * 3,
				3
			)
		}

		this.lastUpdate = Date.now()

		return true
	}

	toBase64() {
		return Buffer.concat(this.canvas).toString('base64')
	}

	verticalLine(x, color) {
		for (var y = 0; y &lt; this.height; y++) {
			this.pixel(x, y, color)
		}

		return true
	}
}

exports = module.exports = Image
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://bitfocus.io/images/topbar-logowhite.png" style="width: 147px; height: 24px">
    <div class="footer-text"> </div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
